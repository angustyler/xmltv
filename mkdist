#!/bin/sh
# 
# Make a distribution tarball from a working copy.  Not very well
# written; all those rm -rfs might be dangerous.
# 
# $Log: mkdist,v $
# Revision 1.3  2001/11/11 16:44:19  epaepa
# Whoops, just realized that the last changelog message would itself get
# keyword-expanded, causing no end of confusion.  I had to perform some
# emergency censorship of funny dollar signs.
#
# Revision 1.2  2001/11/11 16:41:05  epaepa
# Rearranged (or added) comments at the start of each file, so the
# description is near the top and the changelog near the bottom.  Added
# Log: lines to get an automatically updated changelog from now on; I
# hope it works.
#
# 
# -- Ed Avis, epa98@doc.ic.ac.uk
# 

vers=`perl -ne '/^XMLTV\s+([0-9.-]+)\s*$/ && (print("$1\n"), exit)' README`
dir="xmltv-$vers"
if test -e ../$dir; then echo $dir already exists; exit 1; fi
mkdir ../$dir      || exit 1
cp -avi * ../$dir  || exit 1
cd ../$dir         || exit 1
rcs2log >ChangeLog || exit 1
rm -rf RCS         || exit 1
rm -rf attic/RCS   || exit 1
rm -rf cgi         || exit 1
rm -f mkdist       || exit 1
rm -f tvprefs      || exit 1
rm -f uk.xml       || exit 1
rm -f tv.xml       || exit 1
rm -f web_cache.db || exit 1
echo ../$dir
