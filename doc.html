<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>XMLTV</title>
    <link rev="made" href="mailto:epa98@doc.ic.ac.uk">
  </head>

  <body>
    <h1>XMLTV</h1>
    <p>
      XMLTV is a set of utilities to manage your TV viewing.  They
      work with TV listings stored in the XMLTV format, which is based
      on XML.  The idea is to separate out the backend (getting the
      listings) from the frontend (displaying them for the user), and
      to implement useful operations like picking out your favourite
      programmes as filters that read and write XML documents.
    </p>
    <p>
      There are four backends at present, grabbing TV listings for
      different countries.  There are filters to sort the listings by
      date, to remove shows that have already been broadcast, and a
      CGI script to semi-automatically pick things to watch.   There
      are a couple of backends to produce printed output.
    <p>
      This software is still being developed and requires familiarity
      with a command line; but it does work.
    </p>
    <h2>File format</h2>
    <p>
      The format used differs from most other XML-based TV listings
      formats in that it is written from the user's point of view,
      rather that the broadcaster's.  It doesn't divide listings into
      channels, instead all the channels are mixed together into a
      single unified listing.  Each programme has details such as
      name, description, and credits stored as subelements, but
      metadata like broadcast details are stored as attributes.  There
      is support for listings in multiple languages and each programme
      can have 'language' and 'original language' details.
    </p>
    <p>
      For more details, see <a href="xmltv.dtd">the XMLTV DTD</a>.
      If you like, you can make a printable version using <a
	href="http://www.doc.ic.ac.uk/~epa98/work/apps/dtd2latex/">dtd2latex</a>.  The DTD has grown quite large, but almost all the features are optional.
    </p>
    <h2>Getting it</h2>
    <p>
      The latest version is <strong>0.2.2</strong>.  This is just
      small bugfixes frm 0.2.  A lot of stuff has been added since
      0.1.1, in particular the listings-grabbers for Canada and the
      Netherlands.  (Not everything mentioned above is included in the
      standard xmltv distribution, some of it is downloadable from
      other places.)
    </p>
    <h3>Prerequisites</h3>
    <p>
      Quite a few perl modules are required, you can download them
      from <a href="http://www.cpan.org/">CPAN</a> using the links
      below.  They should install using the standard
      <kbd>perl Makefile.PL; make; make test; make install</kbd>
      sequence.
    </p>
    <ul>
      <li><a href="http://www.cpan.org/modules/by-module/XML/XML-DOM-1.25.tar.gz">XML::DOM</a></li>
      <li><a href="http://cpan.valueclick.com/modules/by-module/Date/DateManip-5.39.tar.gz">Date::Manip</a></li>
      <li><a href="http://cpan.valueclick.com/modules/by-module/XML/XML-Writer-0.4.tar.gz">XML::Writer</a></li>
      <li><a href="http://cpan.valueclick.com/modules/by-module/XML/XML-Simple-1.05.tar.gz">XML::Simple</a></li>
      <li><a href="http://cpan.valueclick.com/modules/by-module/Memoize/Memoize-0.52.tar.gz">Memoize</a> and <a href="http://cpan.valueclick.com/modules/by-module/Memoize/Memoize-ExpireLRU-0.55.tar.gz">Memoize::ExpireLRU</a> are highly recommended</li>
      <li><a href="http://cpan.valueclick.com/modules/by-module/Unicode/Unicode-String-2.06.tar.gz">Unicode::String</a> is also highly recommended</li>
    </ul>
    <p>
      Other modules used should be part of the standard perl
      distribution (5.005 or later).  You may want the latest <a
	href="http://cpan.valueclick.com/modules/by-module/LWP/libwww-perl-5.48.tar.gz">libwww-perl</a> bundle.
    </p>
    <h3>Download</h3>
    <p>
      Since you're reading this, you should have already downloaded a
      tarball.  But you can get a new one from <a
	href="http://www.doc.ic.ac.uk/~epa98/work/apps/xmltv/xmltv-0.2.2.tar.gz">http://www.doc.ic.ac.uk/~epa98/work/apps/xmltv/xmltv-0.2.2.tar.gz</a>.
    </p>
    <h3>Installing</h3>
    <p>
      No installing necessary (apart from the many prerequisites).
      Just unpack the tarball and run the programs from that
      directory.  (One uses the library tz_uk.pl which needs to be in
      the current directory or in $PERL5LIB.)
    </p>
    <h2>Usage</h2>
    There are several things to do:
    <ol>
      <li><a href="#get">Get TV and/or radio listings</a></li>
      <li><a href="#sort">Sort the listings</a></li>
      <li><a href="#filter">Filter out old programmes</a></li>
      <li><a href="#pick">Pick what you want to watch</a></li>
      <li><a href="#print">Print out the results</a></li>
    </ol>
    <h3><a name="get">Get the latest listings</a></h3>
    <p>
      The way to get TV listings is to find a website which has them
      in a vaguely readable format, download them and parse them.
      Unfortunately there doesn't seem to be a 'worldwide TV guide'
      website, so a new listings-grabber must be written for each
      listings provider for each country.  So far listings are
      available for <a href="#austria">Austria</a>, <a
	href="#canada">Canada</a>, <a href="#netherlands">the
	Netherlands</a>, and <a href="#uk">the United Kingdom</a>.
      Although the programs to download the listings are different in
      each case, the ways you use them are very similar.
    </p>
    <h4><a name="austria">Listings for Austria</a></h4>
    <p>
      Actually, Austria is an exception - you don't get listings from
      a website but ready-made from an FTP site.  Go to <a
	href="ftp://yasd.dhs.org/xmltv/">ftp://yasd.dhs.org/xmltv/</a>
      and download today's listings as an XML file.  (You can get the
      other files too, but at present it isn't possible to combine
      several XML files into a single listing.)  These listings have
      been made available by Gottfried Szing and are extracted from
      the gtv SQL database.  At this site you can also grab the code
      to import and export them (see below).
    </p>
    <h4><a name="canada">Listings for Canada</a></h4>
    <p>
      Mike Redan has written <code>getlistings_ca</code>, which
      grabs listings from the <a href="http://www.tvguide.ca/">TV
	Guide Canada</a> site.  But to use it you first need to
      go to that site and set up an account.  Then enter your
      preferences so you can get a web page for the channels you have
      available.  At the listings page, go to Preferences at the top
      (you'll need a browser that displays images), then on that page,
      Layout Grid near the bottom.  Change Channels Deep to 100 (or
      maybe ALL?), and Hours Wide to 6 Hours - this is to get as much
      info as possible on a single page.  Choose the options Expanded
      Titles and Program Description.  Press the Layout Grid button,
      then go to Listings at the top (another image link), and you
      should get a huge page of listings which will probably take
      forever to display in your browser.  Look at the URL and find
      the part just after it says 'profileID='.  Copy from after this
      equals sign to the end of the URL, and put this into
      <code>$serviceID</code> in getlistings_ca.
    </p>
    <p>
      Now you can get listings by running:
      <br>
      <kbd>./getlistings_ca &gt;ca.xml</kbd>
      <br>
      It will probably take a while to get all the web pages and
      process them all.  Fortunately one batch of listings lasts for
      several days.  To speed things up, the program keeps a local web
      cache in the file <code>web_cache.db</code> - but it will be
      used only if the cached pages are less than one day old.
    </p>
    <h4><a name="netherlands">Listings for the Netherlands</a></h4>
    <p>
      Rutger Nijlunsing's <code>getlistings_nl</code> downloads TV
      listings from <a
	href="http://portal.omroep.nl/">http://portal.omroep.nl/</a>.
      It has one extra prerequisite: <a
	href="http://curl.haxx.se/">curl</a>, which is a utility to
      get web pages and other things that have a URL.  Once curl is
      installed, you can say:
      <br>
      <kbd>./getlistings_nl &gt;nl.xml</kbd>
      <br>
      This gives enough listings for one day.  At present, the
      data from getlistings_nl does not include programme
      descriptions, only titles.
    </p>
    <h4><a name="uk">Listings for the United Kingdom</a></h4>
    <p>
      <kbd>./getlistings_uk_ananova &gt;uk.xml</kbd>
      <br>
      will get one week of listings from <a
	href="http://www.ananova.com/tv/">Ananova</a>.  At present it
      is hardcoded for the London ITV region (Carlton/LWT), but this
      shouldn't be hard to change.  It gets the five terrestrial
      channels, but this can be changed by editing the constants at
      the top to add digital channels or radio stations.  Like
      <code>getlistings_ca</code>, this takes a while but there is a
      local web cache lasting 24 hours.
    </p>
    <h4>Other countries</h4>
    <p>
      Contributions welcome...
    </p>
    <h3><a name="sort">Sorting the listings</a></h3>
    <p>
      Most of the time the downloaded listings will not be in any
      logical order, and although the start time for each programme is
      given, its stop time may not be.  <code>sort_listings</code>
      deals with this; it acts as a filter for XMLTV files, sorting
      the programmes according to start time (then stop time, then
      channel) and guessing stop times if they aren't filled in.  (A
      programme stops when the next programme on the same channel
      starts.)
    </p>
    <kbd>./sort_listings &lt;ca.xml &gt;sorted.xml</kbd>
    <p>
      (Or whatever filename you have used for the unsorted listings.)
      You may get warnings about 'programmes do not sort': this means
      that there are two shows on the same channel starting at the
      same time and it's not clear which comes first!  This sometimes
      happens when programmes share a timeslot, such as 'News followed
      by Weather'.  Not something to worry about.
    </p>
    <h3><a name="filter">Filtering out things you've already
	missed</a></h3>
    <p>
      Most likely you are not interested in looking through the
      listings of things that have already been broadcast, but were
      left on the website anyway.  This is what
      <code>filter_shown</code> is for.  Note that it looks at the
      stop time to work out what has been shown, so you need to tidy
      the listings with <code>sort_listings</code> before using it.
    </p>
    <kbd>./filter_shown &lt;sorted.xml &gt;filtered.xml</kbd>
    <p>
      You can also use the <code>-d</code> option to give the cutoff
      point for filtering out programmes; the default is 'now'.
    </p>
    <h3><a name="pick">Picking shows to watch</a></h3>
    <p>
      At this point you should have a sorted, filtered XML TV
      listing.  You can just <a href="#print">print it out</a> (but be
      warned: full TV listings usually need about two pages per
      channel per day).  Or if you would like to automate the process
      of looking through the listings deciding what to watch, you can
      use <code>pick_cgi</code>.
    </p>
    <p>
      <code>pick_cgi</code> is a CGI script, which means it needs to
      run in a web browser.  You can install it on your web server as
      <code>pick.cgi</code> and go to it with Netscape (making sure
      the necessary perl modules are on the server too), but it's
      probably easier - though uglier - to view it locally using the
      'CGI emulation' of the Lynx text-mode browser.  In any case, you
      will need to have the big file of listings called
      <code>tv.xml</code>:
      <br>
      <kbd>mv filtered.xml tv.xml</kbd>
    </p>
    <p>
      Then to run it inside Lynx, say:
      <br>
      <kbd>lynx lynxcgi:pick_cgi</kbd>
      <br>
      Quick guide to Lynx: move between radio buttons using up-arrow
      and down-arrow.  Press right-arrow to select a radio button,
      to press an on-screen button like 'Submit' move the highlight to
      it and press Enter.
    </p>
    <p>
      If this is the first time you've run this CGI script, you'll get
      a huge page showing every programme, in date order.  There are
      four choices for what to do:
    </p>
    <ul>
      <li><em>never</em> - no, I don't want to watch it, and don't ask
	me about programmes with this title ever again.</li>
      <li><em>no</em> - I won't watch it this time, but ask me again
	next time.</li>
      <li><em>yes</em> - I might watch it (put it in the output
	listings), but ask me again next time.</li>
      <li><em>always</em> - whenever a programme with this title
	appears, always put it in the output without asking.</li>
    </ul>
    <p>
      The default option for unrecognized titles is <em>never</em>,
      reflecting the fact that most things on TV are rubbish.  Because
      something marked as <em>never</em> is effectively censored from
      all future sessions with pick_cgi, you should be sure to change
      this for any programme you might want to watch in the future.
      Saying <em>no</em> is a safe choice for things you don't want to
      watch.
    </p>
    <p>
      When you've chosen your preferences for everything on the page,
      press 'Submit' and a page will appear confirming your
      preferences and listing which of the programmes will appear in
      the output ('planning to watch').  There will probably be
      several pages of listings, so go to 'Next page' and repeat as
      necessary.  Take comfort in the thought that you'll never have
      to deal with most of these shows ever again :-).  Finally you
      should get a confirmation page saying 'Finished' - you can close
      your browser, or quit Lynx by pressing 'q'.
    </p>
    <p>
      Pick_cgi produces two files as output.  Your preferences are
      stored in <code>tvprefs</code>, listing what to do with
      different programmes.  You might want to check through it
      the first time and make sure you haven't accidentally said
      'never' to something you do want to watch.  Of course, because
      it is a plain text file you can always edit it if you change
      your mind.
    </p>
    <p>
      The output list of programmes is in <code>towatch</code>.  This
      really ought to be an XML file like all the others, but because
      of programmer laziness it's a text file listing indices into
      <code>tv.xml</code>.  You need to decode it:
      <br>
      <kbd>./pick_process &lt;towatch &gt;towatch.xml</kbd>
      <br>
      Now <code>towatch.xml</code> contains details of the things you
      are planning to watch.  If the input to <code>pick_cgi</code>
      was sorted then its output will be too, so you don't need to use
      <code>sort_listings</code> again.  Your personalized listings
      are ready to be printed.
    </p>
    <h3><a name="print">Printing the listings</a></h3>
    <p>
      The filter <code>listings_to_latex</code> converts XMLTV files
      to LaTeX source, which you can then print as any other LaTeX
      document:
      <br>
      <kbd>./listings_to_latex &lt;towatch.xml &gt;towatch.tex</kbd>
      <br>
      <kbd>latex towatch.tex</kbd>
      <br>
      <kbd>dvips towatch.dvi</kbd>
      <br>
      The above example assumes you have a PostScript printer or
      something which emulates a PostScript printer; most Unixy
      systems are set up like this.
    </p>
    <h2>Other stuff</h2>
    <p>
      There are lots of features in the XMLTV file format which are as
      yet unexploited.  Have a look at the DTD for details.
    </p>
    <p>
      Gottfried Szing (the author of <a
	href="http://yasd.dhs.org/gtv.php3">gtv</a>) has written code
      to transfer listings between XMLTV format and the gtv database,
      as well as a Java program to format the listings into PDF.  You
      can get all this at <a
	href="ftp://ftp.yasd.dhs.org/xmltv/">ftp://ftp.yasd.dhs.org/xmltv/</a>. 
    </p>
    <p>
      <a href="http://www.rfc-editor.org/rfc/rfc2838.txt">RFC 2838</a>
      suggests a way of storing channel names based on the existing
      DNS hierarchy (though the channel names are not Internet
      hostnames).  XMLTV is adopting this idea as a way to store
      globally-unique channel names, though at present not all the
      listings-grabbers use it.  Once you have channel names in such a
      format, you have the question of how to translate them into
      human-readable names for printed listings, and into channel
      numbers where there is a standard number for a particular
      channel.  For example, the internal name 'channel4.com'
      corresponds to the display name 'Channel Four' and, in the UK,
      button number 4 on the TV.  The module
      <code>TVChannels.pm</code> is there to do these lookups - the
      data is stored in a file <code>channels.xml</code>.  None of
      this is used at present but it should be in the next release -
      you can find the latest version in the <code>todo/</code>
      directory.
    </p>
    <h2>Authors and copying</h2>
    <p>
      Everything which doesn't have an author listed above was written
      by Ed Avis; Gottfried Szing helped design the file format.
      These programs are free software; you may distribute them under
      the GNU General Public License as published by the Free Software
      Foundation, either version 2 or (at your option) any later
      version.  (See the file COPYING.)
    </p>
    <p>
      There is no warranty for this software, see the file COPYING.
    </p>
    <p>
      Please contact me, <a
	href="mailto:epa98@doc.ic.ac.uk">&lt;epa98@doc.ic.ac.uk&gt;</a>, with
      any suggestions, bug reports, or contributions.  Or if it's
      about a particular listings-grabber, you can mail its author
      (see the comment at the top of each program).
    </p>
    <hr>
    <address><a href="mailto:epa98@doc.ic.ac.uk">Edward Avis</a></address>
    <br><a href="http://petition.eurolinux.org/">Stop software patents in
      the EU</a><br>
<!-- Created: Mon Jul  3 15:46:53 BST 2000 -->
<!-- hhmts start -->
Last modified: Thu Oct 12 14:50:50 BST 2000
<!-- hhmts end -->
  </body>
</html>
